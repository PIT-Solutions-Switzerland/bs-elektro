---
import { toHTML } from '@portabletext/to-html'
import { urlFor } from '../../lib/sanity'

interface Props {
  heading: string
  content: any[]
}

const { heading, content } = Astro.props

const html = toHTML(content, {
  components: {
    block: {
      h3: ({ children }) => `<h3 class="content-module__h3">${children}</h3>`,
      normal: ({ children }) => `<p class="content-module__text">${children}</p>`,
    },
    marks: {
      link: ({ children, value }) => `<a href="${value.href}">${children}</a>`,
    },
    types: {
      image: ({ value }) => {
        if (!value.url && !value.asset) return ''
        const src = value.url || urlFor(value).url()
        const alt = value.alt || ''
        const caption = value.caption || ''
        return `<figure class="content-module__figure">
          <img src="${src}" alt="${alt}" class="content-module__image" loading="lazy" />
          ${caption ? `<figcaption class="content-module__caption">${caption}</figcaption>` : ''}
        </figure>`
      },
      file: ({ value }) => {
        if (!value.fileUrl) return ''
        const title = value.title || 'PDF herunterladen'
        return `<p class="content-module__text"><a href="${value.fileUrl}" target="_blank" rel="noopener noreferrer" class="content-module__pdf-link">${title}</a></p>`
      },
    },
  },
})
---

<section class="content-module">
  <div class="content-module__inner">
    <h2 class="content-module__h2">{heading}</h2>
    <Fragment set:html={html} />
  </div>
</section>
